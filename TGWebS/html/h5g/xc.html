<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title></title>
</head>
<body>
    <canvas id="c1" width="400" height="300">not support</canvas>
    <button type="button" onclick=""></button>
    <script>
        window.onload = function () {
            var g = new Gxc({
                cvs: document.getElementById('c1').getContext('2d'),
                rowCount: 5,
                colCount: 5
            });

            function myClick() {
                c.play({
                    row: 2,
                    col: 2
                }, "n");
            };
        };


        ; (function () {
            var gWidth = 40;
            var gHeight = 40;
            var gStartx = 0;
            var gStarty = 0;
            //var img = new Image();
            //img.src = "ball.png";

            //**************************Entity Function***********************************
            //单元实体
            function grid(opts) {
                this.type = opts.type;
                this.row = opts.row;
                this.col = opts.col;
                this.styleStr = opts.styleStr;
                this.x = opts.x;
                this.y = opts.y;
                this.width = opts.width;
                this.height = opts.height;
            };
            //消除游戏实体
            function Gxc(opts) {
                this.cvs = opts.cvs;
                this.data = [];
                this.types = opts.types ? opts.types : 5;
                this.rowCount = opts.rowCount ? opts.rowCount : 5;
                this.colCount = opts.colCount ? opts.colCount : 5;

                this.renderCvs();
            };
            //绘制单元
            Gxc.prototype.draw = function (ele) {
                var ctx = this.cvs;
                ctx.clearRect(ele.x, ele.y, ele.width, ele.height);//清除绘制矩形
                ctx.fillStyle = ele.styleStr;
                ctx.fillRect(ele.x, ele.y, ele.width - 10, ele.height - 10);
            };
            //获取随机数
            Gxc.prototype.random = function () {
                return 1 + Math.floor(Math.random() * this.types);
            };
            //绘制cvs
            Gxc.prototype.renderCvs = function () {
                var ctx = this.cvs;
                //ctx.drawImage(img, 0, 0, 50, 50);

                for (var ic = 0; ic < this.colCount; ic++) {
                    for (var ir = 0; ir < this.rowCount; ir++) {
                        var px = (ic + 0) * gWidth + gStartx;
                        var py = (ir + 0) * gHeight + gStarty;
                        var ty = this.random();
                        var g = new grid({
                            type: ty,
                            row: ir,
                            col: ic,
                            styleStr: matchStyle(ty),
                            x: px,
                            y: py,
                            width: gWidth,
                            height: gHeight
                        });
                        this.data.push(g);
                    }
                }

                this.refreshCvs();
            };
            //刷新cvs
            Gxc.prototype.refreshCvs = function () {
                for (var i = 0, g; g = this.data[i++];) {
                    this.draw(g);
                }
            };

            Gxc.prototype.play = function (c, direction) {
                var g1 = c;
                var cf = matchDirection(direction);

                var g2 = {
                    row: c.row + cf.r,
                    col: c.col + cf.c
                };

                this.data.filter("row", 1);
            };

            //Gxc.prototype.fix = function (g1, g2) {
            //    for (var i = 0, g; g = this.data[i++];) {
            //        this.draw(g);
            //    }
            //};

            //**************************Common Function***********************************
            function matchStyle(type) {
                var s = "#f2f2f2";
                switch (type) {
                    case 0: s = "#976e6e"; break
                    case 1: s = "#b7c882"; break
                    case 2: s = "#82c89b"; break
                    case 3: s = "#ffc2c2"; break
                    case 4: s = "#607dba"; break
                        //default: return
                }
                return s;
            }

            Array.prototype.filter = function (property, value) {
                console.log(this[property]);
            };

            function matchDirection(direction) {
                var di = {
                    "e": { r: 0, c: -1 },
                    "s": { r: 1, c: 0 },
                    "w": { r: 0, c: 1 },
                    "n": { r: -1, c: 0 },
                };
                return di[direction];
            };

            window.Gxc = Gxc;
        })();
    </script>
</body>
</html>
